<div
  class="rounded-xl border-l-4 shadow-sm p-6 transition-colors duration-200 dark:bg-[#1a1a1a]"
  [ngClass]="{
    'bg-red-50 border-red-500': theme() === 'red',
    'bg-orange-50 border-orange-500': theme() === 'orange',
    'bg-gray-50 border-gray-500': theme() === 'gray',
    'bg-blue-50 border-blue-500': theme() === 'blue',
  }">
  <div class="flex justify-between items-center mb-6">
    <h3 class="text-lg font-bold text-gray-900 dark:text-white">
      {{ titleKey() | transloco }}
    </h3>
    <div
      class="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold"
      [ngClass]="{
        'bg-red-600': theme() === Theme.Red,
        'bg-orange-600': theme() === Theme.Orange,
        'bg-gray-600': theme() === Theme.Gray,
        'bg-blue-600': theme() === Theme.Blue,
      }">
      {{ items().length }}
    </div>
  </div>

  <div class="space-y-3 items-list" [class.isExpanded]="isExpanded()">
    @for (item of visibleItems(); track item.name; let i = $index) {
      <div
        [@staggeredFadeIn]="{ value: '', params: { delay: i * staggerDelayPerItemMs } }"
        class="bg-white dark:bg-[#262626] p-4 rounded-lg flex justify-between items-center shadow-sm">
        <div>
          <h4
            class="font-bold text-gray-900 dark:text-white"
            [ngClass]="{
              'line-through decoration-gray-500': theme() === Theme.Red,
            }">
            {{ item.name }}
          </h4>
          <p class="text-xs text-gray-500 dark:text-gray-400">
            {{ item.location.name }}
          </p>
        </div>
        <div class="text-right">
          <!-- Dynamic Badge Logic handled in template for now -->
          @let timeDiff = getItemTimeDifference(item);
          <span
            class="text-xs font-bold px-2 py-1 rounded"
            [ngClass]="{
              'text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/30': timeDiff.isExpired,
              'text-orange-600 dark:text-orange-400 bg-orange-100 dark:bg-orange-900/30':
                !timeDiff.isExpired && timeDiff.isClose,
              'text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/30':
                !timeDiff.isExpired && !timeDiff.isClose,
            }">
            {{ timeDiff.label }}
          </span>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            {{ item.quantity }} {{ item.unit.name }}
          </p>
        </div>
      </div>
    }
  </div>

  @if (showToggle()) {
    <div class="mt-4 text-center">
      <button
        (click)="toggleExpand()"
        class="text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 font-medium focus:outline-none cursor-pointer transition-colors duration-200">
        @if (isExpanded()) {
          {{ 'common.showLess' | transloco }}
        } @else {
          +{{ hiddenItemsCount() }}
          {{
            (hiddenItemsCount() === 1 ? footerMessageKey() + '_one' : footerMessageKey())
              | transloco
          }}
        }
      </button>
    </div>
  }
</div>
