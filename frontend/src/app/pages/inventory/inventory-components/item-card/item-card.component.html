<div [ngClass]="expired() ? 'bg-red-50 border-red-500' : 'bg-blue-50 border-blue-500'"
    class="dark:bg-[#1a1a1a] rounded-xl p-4 border-l-4 shadow-sm relative transition-colors duration-200 h-full flex flex-col justify-between">
    <div>
        <div class="flex justify-between items-center mb-2">
            <h4 class="text-base font-bold text-gray-900 dark:text-white leading-tight pr-4">
                @if (expired()) {
                <span class="text-yellow-600 dark:text-yellow-500 inline-flex items-center">
                    <i class="pi pi-exclamation-triangle text-sm mr-1"></i>
                </span>
                }
                {{ item().name }}
            </h4>
            <div class="flex gap-1 shrink-0">
                <button (click)="showNote()"
                    class="p-1.5 cursor-pointer bg-gray-500 dark:bg-gray-800 text-white rounded-md hover:bg-gray-700 dark:hover:bg-gray-600 shadow-sm transition-colors shrink-0">
                    <i class="pi pi-info-circle w-4 h-4"></i>
                </button>
                <button (click)="showEdit()"
                    class="p-1.5 cursor-pointer bg-gray-500 dark:bg-gray-800 text-white rounded-md hover:bg-gray-700 dark:hover:bg-gray-600 shadow-sm transition-colors shrink-0">
                    <i class="pi pi-pencil w-4 h-4"></i>
                </button>

                <button (click)="delete.next()"
                    class="p-1.5 cursor-pointer bg-gray-500 dark:bg-gray-800 text-white rounded-md hover:bg-gray-700 dark:hover:bg-gray-600 shadow-sm transition-colors shrink-0">
                    <i class="pi pi-trash w-4 h-4"></i>
                </button>
            </div>
        </div>



        <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
            <div>
                <span class="text-xs text-gray-500 dark:text-gray-400 block mb-0.5">
                    {{ 'itemCard.category' | transloco }}
                </span>
                <span class="font-medium text-gray-900 dark:text-gray-200 truncate block">{{ item().category }}</span>
            </div>
            <div>
                <span class="text-xs text-gray-500 dark:text-gray-400 block mb-0.5">
                    {{ 'itemCard.location' | transloco }}
                </span>
                <span class="font-medium text-gray-900 dark:text-gray-200 truncate block">{{ item().location }}</span>
            </div>
            <div>
                <span class="text-xs text-gray-500 dark:text-gray-400 block mb-0.5">
                    {{ 'itemCard.quantity' | transloco }}
                </span>
                <span class="font-medium text-gray-900 dark:text-gray-200 truncate block">
                    {{ item().quantity }} {{ item().unit }}
                </span>
            </div>
            <div>
                <span class="text-xs text-gray-500 dark:text-gray-400 block mb-0.5">
                    {{ 'itemCard.bestBefore' | transloco }}
                </span>
                <span [ngClass]="expired() ? 'text-red-600 dark:text-red-500' : 'text-blue-600 dark:text-blue-500'"
                    class="font-medium truncate block">
                    {{ item().bestBeforeDate.toLocaleDateString() }}
                </span>
            </div>
            <div>
                <span class="text-xs text-gray-500 dark:text-gray-400 block mb-0.5">
                    {{ 'itemCard.openedDate' | transloco }}
                </span>
                <span class="font-medium text-gray-900 dark:text-gray-200 truncate block">
                    {{ item().openedDate?.toLocaleDateString() ?? 'N/A' }}</span>
            </div>
            <div>
                <span class="text-xs text-gray-500 dark:text-gray-400 block mb-0.5">
                    {{ 'itemCard.purchaseDate' | transloco }}
                </span>
                <span class="font-medium text-gray-900 dark:text-gray-200 truncate block">
                    {{ item().purchaseDate.toLocaleDateString() }}</span>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <div class="flex justify-between items-end mb-1">
            <span class="text-xs text-gray-500 dark:text-gray-400">{{ 'itemCard.timeRemaining' | transloco }}</span>
            <span class="text-xs font-medium text-gray-900 dark:text-gray-200">{{ timeRemaining() }}</span>
        </div>
        <!-- Progress Bar -->
        <div [ngClass]="expired() ? 'bg-red-200 dark:bg-red-900/30' : 'bg-blue-200 dark:bg-blue-900/30'"
            class="w-full rounded-full h-1.5">
            <div [ngClass]="expired() ? 'bg-red-600 dark:bg-red-500' : 'bg-blue-600 dark:bg-blue-500'"
                class="h-1.5 rounded-full max-w-full" [style.width.%]="itemProgress()"></div>
        </div>
    </div>
</div>

<p-dialog [visible]="displayNoteDialog()" (visibleChange)="displayNoteDialog.set($event)" [modal]="true"
    [dismissableMask]="true" [style]="{width: '50vw'}" [header]="item().name">
    <p class="m-0 text-gray-700 dark:text-gray-300 leading-relaxed">
        {{ item().notes ? item().notes : 'No notes.' }}
    </p>
    <ng-template pTemplate="footer">
        <p-button label="Close" (click)="displayNoteDialog.set(false)" styleClass="p-button-text"></p-button>
    </ng-template>
</p-dialog>

<p-dialog [visible]="displayEditDialog()" (visibleChange)="displayEditDialog.set($event)" [modal]="true"
    [dismissableMask]="true" [style]="{width: '50vw'}" [header]="'Edit ' + item().name">
    <edit-item-form [itemToEdit]="item()" (updateItem$)="onEditItem($event)"></edit-item-form>
</p-dialog>